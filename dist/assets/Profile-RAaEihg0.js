import{e as T,h as D,m as k,r as n,i as O,o as A,j as e,M as C,b as S,A as P,B as r,n as U,s as V,p as E,q as $,T as R,d as L,t as q}from"./index-BK9-5p3Z.js";const M=T().shape({email:D().email("Invalid email format").required("Email is required")}),B=T().shape({otp:k().typeError("OTP must be a number").test("len","OTP must be exactly 6 digits",c=>c&&c.toString().length===6).required("OTP is required")}),_=({CloseEmailModal:c})=>{const j=localStorage.getItem("phone"),[p,f]=n.useState(1),[x,l]=n.useState(!1),[g,i]=n.useState(null),{register:N,handleSubmit:h,formState:{errors:o}}=O({resolver:A(M)}),{register:w,handleSubmit:v,formState:{errors:b}}=O({resolver:A(B)}),y=async m=>{var t,s;i(m.email);const u={email:m.email,fname:localStorage.getItem("fname"),lname:localStorage.getItem("lname")};try{l(!0),(await S.post(`${P}/api/otp`,u)).status===200&&(r.success("OTP sent successfully!"),l(!1),f(2))}catch(a){console.error("Error sending OTP:",a),((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)==="EMAIL_ALREADY_EXISTS"?(r.error("This email is already associated with another account."),i(null),c()):r.error("An error occurred. Please try again."),l(!1)}},d=async m=>{var t,s;const u={email:g,otp:m.otp};try{l(!0),(await S.post(`${P}/api/validate-otp`,u)).status===200?(await S.post(`${P}/api/emailupdate?phone=${j}`,{email:g})).status===200&&(localStorage.setItem("email",g),r.success("Email updated successfully!"),i(null),c()):r.error("Invalid OTP. Please try again.")}catch(a){console.error("Error validating OTP:",a),((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.error)==="INVALID_OTP"?r.error("Invalid OTP."):r.error("An error occurred. Please try again."),l(!1)}finally{l(!1)}};return e.jsx(e.Fragment,{children:e.jsx(C,{children:e.jsxs("div",{className:"w-[550px] min-h-[330px] my-4 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>c(),children:"x"}),p===1&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-4",children:"Update Email"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-8",children:"Enter your new email address. A verification OTP will be sent to this email."}),e.jsxs("form",{onSubmit:h(y),children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1",children:[e.jsx("label",{htmlFor:"email",className:"text-lg",children:"New Email"}),e.jsx("input",{type:"text",className:`py-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none my-3 ${o.email?"border-red-500":""}`,placeholder:"johndoe@gmail.com",...N("email")}),o.email&&e.jsx("p",{className:"text-red-500 text-sm",children:o.email.message})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:`font-normal bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ${x?"opacity-50 pointer-events-none":""}`,type:"submit",children:x?"Sending...":"Send OTP"})})]})]}),p===2&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-4",children:"Validate OTP"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-8",children:"Enter the OTP sent to your new email to update your profile."}),e.jsxs("form",{onSubmit:v(d),children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1",children:[e.jsx("label",{htmlFor:"otp",className:"text-lg",children:"OTP"}),e.jsx("input",{type:"text",className:`py-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none my-3 ${b.otp?"border-red-500":""}`,placeholder:"Enter OTP",...w("otp")}),b.otp&&e.jsx("p",{className:"text-red-500 text-sm",children:b.otp.message})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:`font-normal bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-48 py-2.5 my-2 ${x?"opacity-50 pointer-events-none":""}`,type:"submit",children:x?"Validating...":"Validate & Update"})})]})]})]})})})},z=({ClosePhoneModal:c})=>{const j=localStorage.getItem("email"),[p,f]=n.useState(""),[x,l]=n.useState(!1),[g,i]=n.useState(localStorage.getItem("countryCode")),[N,h]=n.useState(!1);n.useState(""),localStorage.getItem("countryCode")+localStorage.getItem("phone");const[o,w]=n.useState({otp1:"",otp2:"",otp3:"",otp4:"",otp5:"",otp6:""}),v=(t,s)=>{w({...o,[t]:s.target.value})},b=t=>{if(t.key==="Delete"||t.key==="Backspace"){const s=t.target.tabIndex-2;s>-1&&t.target.form.elements[s].focus()}else{const s=t.target.tabIndex;s<6&&t.target.form.elements[s].focus()}};n.useEffect(()=>()=>{window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),delete window.recaptchaVerifier)},[]);const y=()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new $(E,"recaptcha-container",{size:"invisible",callback:t=>{console.log("reCAPTCHA verified")}}))},d=(t,s)=>{f(t),i(s.dialCode)},m=async t=>{t.preventDefault();try{if(!p){r.error("Mobile Number is required.");return}l(!0),y();const s=window.recaptchaVerifier,a=p.startsWith("+")?p:"+"+p,I=await V(E,a,s);window.confirmationResult=I,r.success("OTP sent successfully!"),l(!1),h(!0)}catch(s){console.error("Invalid sign-in process",s),s.code==="auth/invalid-phone-number"?r.error("Invalid phone number format. Please enter a valid number."):s.code==="auth/quota-exceeded"?r.error("SMS quota exceeded. Try again later."):s.code==="auth/billing-not-enabled"?r.error("Billing is not enabled in your Firebase project. Please enable it."):r.error("Invalid sign-in process"),l(!1)}},u=async t=>{t.preventDefault();const s=o.otp1+o.otp2+o.otp3+o.otp4+o.otp5+o.otp6;try{l(!0);const a=window.confirmationResult;if(!a){r.error("Please request a new OTP."),l(!1);return}await a.confirm(s);const I=p.slice(g.length),F=await S.post(`${P}/api/phoneupdate?email=${j}`,{phone:I,countryCode:g});F.data.success?(localStorage.setItem("phone",I),r.success("Phone number verified & updated successfully!"),c()):F.data.error==="PHONE_ALREADY_EXISTS"&&(r.error("This phone number is already associated with another account."),l(!1))}catch(a){console.error("Error in OTP verification or phone update",a),a.code==="auth/invalid-verification-code"?(r.error("Invalid OTP. Please try again."),c()):a.response&&a.response.data&&a.response.data.error?a.response.data.error==="PHONE_ALREADY_EXISTS"?(r.error("This phone number is already associated with another account."),c()):r.error("Unexpected error: "+a.response.data.message):r.error("An error occurred during verification. Please try again."),l(!1)}};return e.jsxs(C,{children:[e.jsxs("div",{className:"w-[530px] min-h-[330px] my-3 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>c(),children:"x"}),N?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-2",children:"Verify OTP"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-6",children:"Enter the OTP sent to your phone number"}),e.jsxs("form",{onSubmit:u,children:[e.jsx("div",{className:"flex justify-center gap-3 my-6",children:Object.keys(o).map((t,s)=>e.jsx("input",{name:t,type:"text",autoComplete:"off",className:"w-12 h-14 text-center border-2 bg-transparent outline-none",value:o[t],onChange:a=>v(t,a),tabIndex:s+1,maxLength:"1",onKeyUp:a=>b(a)},t))}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",type:"submit",children:x?"Verifying...":"verify"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-2",children:"Update Phone"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-6",children:"Enter your new Phone Number (please note we will send an OTP to your new phone number)"}),e.jsxs("form",{onSubmit:m,children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1 my-8",children:[e.jsx("label",{htmlFor:"phone",className:"text-normal",children:"Phone"}),e.jsx("div",{className:"w-5/6 mx-6",children:e.jsx(U,{country:"in",onChange:d,className:"w-full py-1 text-black rounded-md shadow-md outline-none bg-white ",inputStyle:{border:"none",fontSize:"16px",marginLeft:"10px"},placeholder:"9999999999",buttonStyle:{width:"30px",borderRadius:"8px",marginLeft:"10px",border:"none",background:"white"}})})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",type:"submit",children:x?"Sending OTP...":"send OTP"})})]})]})]}),e.jsx("div",{id:"recaptcha-container"})]})},H=({CloseProfileModal:c})=>{const{global:j,setGlobal:p}=n.useContext(R),[f,x]=n.useState(null),[l,g]=n.useState(""),[i,N]=n.useState(""),[h,o]=n.useState(!1),w=y=>{const d=y.target.files[0];if(!d){r.error("Please select a file!");return}const m=2*1024*1024;if(d.size>m){r.error("File size exceeds 2MB!");return}x(d);const u=new FileReader;u.onload=()=>{const t=u.result;g(t),N(t)},u.readAsDataURL(d)},v=async()=>{if(!f){r.error("No file selected!");return}const y={name:f.name,user:localStorage.getItem("user"),image:l};try{o(!0);const d=await S.post(`${P}/api/images`,y);d.status===200?(r.success(d.data.message),o(!1),p(!j),c()):(console.log("Failed to Upload"),o(!1))}catch(d){console.log(d),o(!1)}},b=()=>{document.getElementById("file-input").click()};return e.jsx(C,{children:e.jsxs("div",{className:"w-[530px] min-h-[330px] my-3 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>c(),children:"x"}),e.jsx("p",{className:"mx-16 text-xl my-2",children:"Choose Profile Image"}),e.jsxs("div",{className:"relative mt-6 mx-16 bg-white  rounded-lg ",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose File"}),e.jsx("input",{type:"file",className:"hidden",id:"file-input",accept:".jpg,.jpeg,.png,.gif",onChange:w})]}),e.jsx("button",{className:"bg-gray-300 text-black px-4 py-2.5 rounded-md",for:"file-input",onClick:b,children:"Choose Files"}),e.jsx("span",{className:"absolute top-1/2 -translate-y-1/2 lg:right-4 md:right-4 right-16 text-normal text-black",id:"file-name",children:"No Files Chosen"})]}),i&&e.jsxs("div",{className:"text-center text-lg my-2",children:[e.jsx("p",{className:"text-center text-xl my-2",children:"Preview "}),e.jsx("img",{src:i,alt:"Preview",className:"w-60 mx-auto"})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",onClick:v,children:h?e.jsxs("span",{className:"flex justify-center gap-3",children:[" ",e.jsx(L,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Uploading...."})]}):"Upload a Image"})})]})})},Y=()=>{const[c,j]=n.useState(!1),[p,f]=n.useState(!1),[x,l]=n.useState(!1),g=localStorage.getItem("user"),[i,N]=n.useState({}),[h,o]=n.useState({});n.useEffect(()=>{w(),v()},[x]);const w=async()=>{try{const u=(await S.get(`${P}/api/getusersbyid?id=${g}`)).data.user;N(u)}catch(m){console.log(m)}},v=async()=>{try{const u=(await S.get(`${P}/api/getimagebyid?user=${g}`)).data.user;o(u)}catch(m){console.log(m)}},b=()=>{j(!c)},y=()=>{f(!p)},d=()=>{l(!x)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-5 my-6 font-poppins",children:[e.jsxs("div",{className:" flex flex-col mx-6",children:[e.jsx("img",{src:h!=null&&h.image?h.image:q,alt:"Profile",className:`w-40 h-40 ${h!=null&&h.image?" rounded-3xl object-cover":""}`}),e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] lg:w-40 md:w-40 w-40 py-2.5 my-5 ",onClick:()=>l(!0),children:"Change Image"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("p",{className:"font-extralight text-normal",children:"Personal Information"}),e.jsx("hr",{className:"my-3 border-1 border-gray-600 "}),e.jsxs("div",{className:"grid grid-cols-12 gap-10 font-poppins text-normal font-extralight my-5 mx-2 text-gray-400",children:[e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"fname",children:"First Name"}),e.jsx("input",{type:"text",className:" text-white py-3 pe-0 ps-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"John",defaultValue:(i==null?void 0:i.fname)||""})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"lname",children:"Last Name"}),e.jsx("input",{type:"text",className:"text-white py-3 pe-0 ps-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"Doe",defaultValue:(i==null?void 0:i.lname)||""})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"dob",children:"Date Of Birth"}),e.jsx("input",{type:"text",className:"text-white py-3 pe-0 ps-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"25-12-2024",defaultValue:(i==null?void 0:i.dob)||""})]})]})]}),e.jsxs("div",{className:"my-8",children:[e.jsx("p",{className:"font-extralight text-normal",children:"Contact Information"}),e.jsx("hr",{className:"my-3 border-1 border-gray-600 "}),e.jsxs("div",{className:"grid grid-cols-12 gap-10 font-poppins text-normal font-extralight my-5 mx-2 text-white",children:[e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",className:" py-3 pe-0 ps-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-white outline-none  disabled:pointer-events-none text-white",placeholder:"johndoe@gmail.com",value:localStorage.getItem("email")||""})]}),e.jsx("div",{className:"flex justify-center my-2",children:e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center px-10 py-2.5 my-3 ",onClick:()=>j(!0),children:"Update"})})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"text",className:" py-3 pe-0 ps-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-white outline-none  disabled:pointer-events-none text-white",placeholder:"1234567890",value:localStorage.getItem("phone")||""})]}),e.jsx("div",{className:"flex justify-center my-2",children:e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center px-10 py-2.5 my-3 ",onClick:()=>f(!0),children:"Update"})})]})]})]})]}),c&&e.jsx(_,{CloseEmailModal:b}),p&&e.jsx(z,{ClosePhoneModal:y}),x&&e.jsx(H,{CloseProfileModal:d})]})};export{Y as default};
