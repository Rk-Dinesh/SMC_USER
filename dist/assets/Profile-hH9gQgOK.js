import{r,e as E,o as T,j as e,M as O,i as k,b as P,A as I,B as s,k as U,m as V,n as $,s as R,p as D,q as L,T as q,d as M,t as B}from"./index-CyZ-11mO.js";const _=k().shape({email:U().email("Invalid email format").required("Email is required")}),z=k().shape({otp:V().typeError("OTP must be a number").test("len","OTP must be exactly 6 digits",l=>l&&l.toString().length===6).required("OTP is required")}),H=({CloseEmailModal:l})=>{const N=localStorage.getItem("phone"),[p,y]=r.useState(1),[x,n]=r.useState(!1),[g,o]=r.useState(null),{register:v,handleSubmit:h,formState:{errors:f}}=E({resolver:T(_)}),{register:C,handleSubmit:c,formState:{errors:j}}=E({resolver:T(z)}),w=async m=>{var b,S;o(m.email);const u={email:m.email,fname:localStorage.getItem("fname"),lname:localStorage.getItem("lname")};try{n(!0),(await P.post(`${I}/api/otp`,u)).status===200&&(s.success("OTP sent successfully!"),n(!1),y(2))}catch(t){console.error("Error sending OTP:",t),((S=(b=t.response)==null?void 0:b.data)==null?void 0:S.error)==="EMAIL_ALREADY_EXISTS"?(s.error("This email is already associated with another account."),o(null),l()):s.error("An error occurred. Please try again."),n(!1)}},d=async m=>{var b,S;const u={email:g,otp:m.otp};try{n(!0),(await P.post(`${I}/api/validate-otp`,u)).status===200?(await P.post(`${I}/api/emailupdate?phone=${N}`,{email:g})).status===200&&(localStorage.setItem("email",g),s.success("Email updated successfully!"),o(null),l()):s.error("Invalid OTP. Please try again.")}catch(t){console.error("Error validating OTP:",t),((S=(b=t.response)==null?void 0:b.data)==null?void 0:S.error)==="INVALID_OTP"?s.error("Invalid OTP."):s.error("An error occurred. Please try again."),n(!1)}finally{n(!1)}};return e.jsx(e.Fragment,{children:e.jsx(O,{children:e.jsxs("div",{className:"w-[550px] min-h-[330px] my-4 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>l(),children:"x"}),p===1&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-4",children:"Update Email"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-8",children:"Enter your new email address. A verification OTP will be sent to this email."}),e.jsxs("form",{onSubmit:h(w),children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1",children:[e.jsx("label",{htmlFor:"email",className:"text-lg",children:"New Email"}),e.jsx("input",{type:"text",className:`py-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none my-3 ${f.email?"border-red-500":""}`,placeholder:"johndoe@gmail.com",...v("email")}),f.email&&e.jsx("p",{className:"text-red-500 text-sm",children:f.email.message})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:`font-normal bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ${x?"opacity-50 pointer-events-none":""}`,type:"submit",children:x?"Sending...":"Send OTP"})})]})]}),p===2&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-4",children:"Validate OTP"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-8",children:"Enter the OTP sent to your new email to update your profile."}),e.jsxs("form",{onSubmit:c(d),children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1",children:[e.jsx("label",{htmlFor:"otp",className:"text-lg",children:"OTP"}),e.jsx("input",{type:"text",className:`py-2 block w-full bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none my-3 ${j.otp?"border-red-500":""}`,placeholder:"Enter OTP",...C("otp")}),j.otp&&e.jsx("p",{className:"text-red-500 text-sm",children:j.otp.message})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:`font-normal bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-48 py-2.5 my-2 ${x?"opacity-50 pointer-events-none":""}`,type:"submit",children:x?"Validating...":"Validate & Update"})})]})]})]})})})},X=({ClosePhoneModal:l})=>{const N=localStorage.getItem("email"),[p,y]=r.useState(""),[x,n]=r.useState(!1),[g,o]=r.useState(localStorage.getItem("countryCode")),[v,h]=r.useState(!1),[f,C]=r.useState("");localStorage.getItem("countryCode")+localStorage.getItem("phone");const[c,j]=r.useState({otp1:"",otp2:"",otp3:"",otp4:"",otp5:"",otp6:""}),w=(t,a)=>{j({...c,[t]:a.target.value})},d=t=>{if(t.key==="Delete"||t.key==="Backspace"){const a=t.target.tabIndex-2;a>-1&&t.target.form.elements[a].focus()}else{const a=t.target.tabIndex;a<6&&t.target.form.elements[a].focus()}};r.useEffect(()=>()=>{window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),delete window.recaptchaVerifier)},[]);const m=()=>{window.recaptchaVerifier||(window.recaptchaVerifier=new L(D,"recaptcha-container",{size:"invisible",callback:t=>{console.log("reCAPTCHA verified")}}))},u=(t,a)=>{y(t),o(a.dialCode)},b=async t=>{t.preventDefault();try{if(!p){s.error("Mobile Number is required.");return}n(!0),m();const a=window.recaptchaVerifier,i=p.startsWith("+")?p:"+"+p,F=await R(D,i,a);window.confirmationResult=F,s.success("OTP sent successfully!"),n(!1),h(!0)}catch(a){console.error("Invalid sign-in process",a),a.code==="auth/invalid-phone-number"?s.error("Invalid phone number format. Please enter a valid number."):a.code==="auth/quota-exceeded"?s.error("SMS quota exceeded. Try again later."):a.code==="auth/billing-not-enabled"?s.error("Billing is not enabled in your Firebase project. Please enable it."):s.error("Invalid sign-in process"),n(!1)}},S=async t=>{t.preventDefault();const a=c.otp1+c.otp2+c.otp3+c.otp4+c.otp5+c.otp6;try{n(!0);const i=window.confirmationResult;if(!i){s.error("Please request a new OTP."),n(!1);return}await i.confirm(a);const F=p.slice(g.length),A=await P.post(`${I}/api/phoneupdate?email=${N}`,{phone:F,countryCode:g});A.data.success?(localStorage.setItem("phone",F),s.success("Phone number verified & updated successfully!"),l()):A.data.error==="PHONE_ALREADY_EXISTS"&&(s.error("This phone number is already associated with another account."),n(!1))}catch(i){console.error("Error in OTP verification or phone update",i),i.code==="auth/invalid-verification-code"?(s.error("Invalid OTP. Please try again."),l()):i.response&&i.response.data&&i.response.data.error?i.response.data.error==="PHONE_ALREADY_EXISTS"?(s.error("This phone number is already associated with another account."),l()):s.error("Unexpected error: "+i.response.data.message):s.error("An error occurred during verification. Please try again."),n(!1)}};return e.jsxs(O,{children:[e.jsxs("div",{className:"w-[530px] min-h-[330px] my-3 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>l(),children:"x"}),v?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-2",children:"Verify OTP"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-6",children:"Enter the OTP sent to your phone number"}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{className:"flex justify-center gap-3 my-6",children:Object.keys(c).map((t,a)=>e.jsx("input",{name:t,type:"text",autoComplete:"off",className:"w-12 h-14 text-center border-2 bg-transparent outline-none",value:c[t],onChange:i=>w(t,i),tabIndex:a+1,maxLength:"1",onKeyUp:i=>d(i)},t))}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",type:"submit",children:x?"Verifying...":"verify"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-center text-lg my-2",children:"Update Phone"}),e.jsx("p",{className:"text-center text-sm lg:mx-12 md:mx-12 mx-4 my-6",children:"Enter your new Phone Number (please note we will send an OTP to your new phone number)"}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"lg:mx-6 md:mx-6 mx-1 my-8",children:[e.jsx("label",{htmlFor:"phone",className:"text-normal",children:"Phone"}),e.jsx("div",{className:"w-5/6 mx-6",children:e.jsx($,{country:"in",onChange:u,className:"w-full py-1 text-black rounded-md shadow-md outline-none bg-white ",inputStyle:{border:"none",fontSize:"16px",marginLeft:"10px"},placeholder:"9999999999",buttonStyle:{width:"30px",borderRadius:"8px",marginLeft:"10px",border:"none",background:"white"}})})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",type:"submit",children:x?"Sending OTP...":"send OTP"})})]})]})]}),e.jsx("div",{id:"recaptcha-container"})]})},Y=({CloseProfileModal:l})=>{const{global:N,setGlobal:p}=r.useContext(q),[y,x]=r.useState(null),[n,g]=r.useState(""),[o,v]=r.useState(""),[h,f]=r.useState(!1),C=w=>{const d=w.target.files[0];if(!d){s.error("Please select a file!");return}const m=2*1024*1024;if(d.size>m){s.error("File size exceeds 2MB!");return}x(d);const u=new FileReader;u.onload=()=>{const b=u.result;g(b),v(b)},u.readAsDataURL(d)},c=async()=>{if(!y){s.error("No file selected!");return}const w={name:y.name,user:localStorage.getItem("user"),image:n};try{f(!0);const d=await P.post(`${I}/api/images`,w);d.status===200?(s.success(d.data.message),f(!1),p(!N),l()):(console.log("Failed to Upload"),f(!1))}catch(d){console.log(d),f(!1)}},j=()=>{document.getElementById("file-input").click()};return e.jsx(O,{children:e.jsxs("div",{className:"w-[530px] min-h-[330px] my-3 mx-8 font-extralight font-poppins",children:[e.jsx("p",{className:"text-end text-2xl font-medium",onClick:()=>l(),children:"x"}),e.jsx("p",{className:"mx-16 text-xl my-2",children:"Choose Profile Image"}),e.jsxs("div",{className:"relative mt-6 mx-16 bg-white  rounded-lg ",children:[e.jsxs("label",{className:"block",children:[e.jsx("span",{className:"sr-only",children:"Choose File"}),e.jsx("input",{type:"file",className:"hidden",id:"file-input",accept:".jpg,.jpeg,.png,.gif",onChange:C})]}),e.jsx("button",{className:"bg-gray-300 text-black px-4 py-2.5 rounded-md",for:"file-input",onClick:j,children:"Choose Files"}),e.jsx("span",{className:"absolute top-1/2 -translate-y-1/2 lg:right-4 md:right-4 right-16 text-normal text-black",id:"file-name",children:"No Files Chosen"})]}),o&&e.jsxs("div",{className:"text-center text-lg my-2",children:[e.jsx("p",{className:"text-center text-xl my-2",children:"Preview "}),e.jsx("img",{src:o,alt:"Preview",className:"w-60 mx-auto"})]}),e.jsx("div",{className:"flex justify-center my-8",children:e.jsx("button",{className:" font-normal   bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center w-36 py-2.5 my-2 ",onClick:c,children:h?e.jsxs("span",{className:"flex justify-center gap-3",children:[" ",e.jsx(M,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Uploading...."})]}):"Upload a Image"})})]})})},G=()=>{const[l,N]=r.useState(!1),[p,y]=r.useState(!1),[x,n]=r.useState(!1),g=localStorage.getItem("user"),[o,v]=r.useState({}),[h,f]=r.useState({});r.useEffect(()=>{C(),c()},[x]);const C=async()=>{try{const u=(await P.get(`${I}/api/getusersbyid?id=${g}`)).data.user;v(u)}catch(m){console.log(m)}},c=async()=>{try{const u=(await P.get(`${I}/api/getimagebyid?user=${g}`)).data.user;f(u)}catch(m){console.log(m)}},j=()=>{N(!l)},w=()=>{y(!p)},d=()=>{n(!x)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-5 my-6 font-poppins overflow-hidden",children:[e.jsxs("div",{className:" flex flex-col mx-6",children:[e.jsx("img",{src:h!=null&&h.image?h.image:B,alt:"Profile",className:`w-40 h-40 ${h!=null&&h.image?" rounded-3xl object-cover":""}`}),e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] lg:w-40 md:w-40 w-40 py-2.5 my-5 ",onClick:()=>n(!0),children:"Change Image"})]}),e.jsxs("div",{className:"my-5",children:[e.jsx("p",{className:"font-extralight text-normal",children:"Personal Information"}),e.jsx("hr",{className:"my-3 border-1 border-gray-600 "}),e.jsxs("div",{className:"grid grid-cols-12 gap-10 font-poppins text-normal font-extralight my-5 mx-2 text-gray-400",children:[e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"fname",children:"First Name"}),e.jsx("input",{type:"text",className:" text-white py-3 pe-0 ps-2 block lg:w-full md:w-full w-auto bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"John",defaultValue:(o==null?void 0:o.fname)||""})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"lname",children:"Last Name"}),e.jsx("input",{type:"text",className:"text-white py-3 pe-0 ps-2 block lg:w-full md:w-full w-auto bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"Doe",defaultValue:(o==null?void 0:o.lname)||""})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsx("label",{htmlFor:"dob",children:"Date Of Birth"}),e.jsx("input",{type:"text",className:"text-white py-3 pe-0 ps-2 block lg:w-full md:w-full w-auto bg-transparent border-t-transparent border-b border-x-transparent border-b-gray-400 outline-none  disabled:pointer-events-none",placeholder:"25-12-2024",defaultValue:(o==null?void 0:o.dob)||""})]})]})]}),e.jsxs("div",{className:"my-8",children:[e.jsx("p",{className:"font-extralight text-normal",children:"Contact Information"}),e.jsx("hr",{className:"my-3 border-1 border-gray-600 "}),e.jsxs("div",{className:"grid grid-cols-12 gap-10 font-poppins text-normal font-extralight my-5 mx-2 text-white",children:[e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"text",className:" py-3 pe-0 ps-2 block lg:w-full md:w-full w-auto bg-transparent border-t-transparent border-b border-x-transparent border-b-white outline-none  disabled:pointer-events-none text-white",placeholder:"johndoe@gmail.com",value:localStorage.getItem("email")||""})]}),e.jsx("div",{className:"flex lg:justify-center md:justify-center justify-start my-2",children:e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center px-10 py-2.5 my-3 ",onClick:()=>N(!0),children:"Update"})})]}),e.jsxs("div",{className:"lg:col-span-4 md:col-span-4 col-span-12 ",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"text",className:" py-3 pe-0 ps-2 block lg:w-full md:w-full w-auto bg-transparent border-t-transparent border-b border-x-transparent border-b-white outline-none  disabled:pointer-events-none text-white",placeholder:"1234567890",value:localStorage.getItem("phone")||""})]}),e.jsx("div",{className:"flex lg:justify-center md:justify-center justify-start my-2",children:e.jsx("button",{className:" text-base  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] text-center px-10 py-2.5 my-3 ",onClick:()=>y(!0),children:"Update"})})]})]})]})]}),l&&e.jsx(H,{CloseEmailModal:j}),p&&e.jsx(X,{ClosePhoneModal:w}),x&&e.jsx(Y,{CloseProfileModal:d})]})};export{G as default};
